# 进程与线程

## 目的

操作系统提供三种方法处理 `并发` (`concurrency`)

* 进程 (`process`)

    * 由内核来调度
    * 对应一个独立的 `虚拟地址空间`
    * 通信叫做 `进程间通信` (interprocess communication, IPC)

> 让程序有一种错觉，只有它一个程序在跑、只有它在独享 `CPU` `内存` `I/O`、内存里只有它的数据

* I/O 多路复用

    * 进程程序自己维护一个状态机，控制、调度逻辑流

* 线程 (`thread`)

    * 在一个进程里进行，线程与线程共享一个 `地址空间`，共享全局变量
    * 由内核进行调度

`线程` 比 `进程` 轻量，通信更高效

## 浏览器架构历程

1. 单进程时代

2007年前，浏览器都是单进程架构的

底下分为页面线程、网络线程、其他线程等

缺点：

* **不稳定**： 早期浏览器的web视频、web游戏借助插件实现，插件崩溃浏览器也崩溃
* **不流畅**：死循环JS、内存无意泄漏，让浏览器开久了会变慢
* **不安全**：浏览器漏洞、恶意插件

2. 多进程时代

Chrome推出了新架构，一个页面就有这几个进程

基本

* 主进程
* 渲染进程 (放沙箱里)
* 插件进程 (放沙箱里)

> 沙箱，意味着不能读写本地文件

进化

* 网络进程
* GPU进程

优点：

* **稳定**： 一个页面、插件崩溃，不影响其它
* **流畅**：一个页面的 `Javascript` 阻塞了渲染，不影响其它页面
* **安全**：沙箱阻止了渲染、插件中的恶意代码

缺点：

* 资源占用大
* 架构各模块耦合越来越大，现在已很难重构、拓展

3. 未来

面向服务的架构

会把UI、数据库、文件、设备、网络等，抽出来作为独立的服务，放在底层供使用

设计出 IPC 来通信、接口来访问